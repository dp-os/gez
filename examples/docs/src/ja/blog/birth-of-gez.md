---
titleSuffix: "マイクロフロントエンドの課題から ESM イノベーションへ：Gez フレームワークの進化の道"
description: Gez フレームワークが従来のマイクロフロントエンドアーキテクチャの課題から ESM ベースのイノベーションへと進化した過程を深く掘り下げ、パフォーマンス最適化、依存関係管理、ビルドツール選定などの技術的実践経験を共有します。
head:
  - - meta
    - property: keywords
      content: Gez, マイクロフロントエンドフレームワーク, ESM, Import Maps, Rspack, モジュールフェデレーション, 依存関係管理, パフォーマンス最適化, 技術進化, サーバーサイドレンダリング
sidebar: false
---

# コンポーネント共有からネイティブモジュール化へ：Gez マイクロフロントエンドフレームワークの進化の道

## プロジェクト背景

過去数年間、マイクロフロントエンドアーキテクチャは正しい道を模索してきました。しかし、私たちが目にしたのは、理想的なマイクロフロントエンドの世界を模倣するための複雑な技術ソリューションでした。これらのソリューションは、重いパフォーマンス負荷をもたらし、シンプルな開発を複雑にし、標準的なプロセスを難解にしました。

### 従来のソリューションの限界

マイクロフロントエンドアーキテクチャの実践において、従来のソリューションには多くの制限があることを痛感しました：

- **パフォーマンスの低下**：ランタイムでの依存関係注入、JS サンドボックスのプロキシ処理など、すべての操作が貴重なパフォーマンスを消費します
- **脆弱な隔離**：手動で構築されたサンドボックス環境は、ブラウザのネイティブな隔離能力には到底及びません
- **ビルドの複雑さ**：依存関係を処理するために、ビルドツールを魔改造しなければならず、シンプルなプロジェクトが保守困難になります
- **カスタマイズルール**：特別なデプロイ戦略やランタイム処理により、現代の開発標準プロセスから逸脱します
- **エコシステムの制限**：フレームワークの結合、カスタムAPIにより、技術選定が特定のエコシステムに縛られます

これらの問題は、2019年のある企業向けプロジェクトで特に顕著でした。当時、大規模な製品が十数個の独立した業務サブシステムに分割され、これらのサブシステムは共通の基本コンポーネントと業務コンポーネントを共有する必要がありました。最初に採用した npm パッケージベースのコンポーネント共有ソリューションは、共有コンポーネントが更新されるたびに、そのコンポーネントに依存するすべてのサブシステムが完全なビルドとデプロイプロセスを経なければならないという深刻な保守効率の問題を露呈しました。

## 技術進化

### v1.0：リモートコンポーネントの探求

コンポーネント共有の効率問題を解決するため、Gez v1.0 では HTTP プロトコルベースの RemoteView コンポーネントメカニズムを導入しました。このソリューションは、ランタイムでの動的リクエストにより、サービス間のコードをオンデマンドで組み立てることを実現し、ビルド依存チェーンの長さの問題を解決しました。しかし、標準化されたランタイム通信メカニズムが欠如していたため、サービス間の状態同期とイベント伝達には依然として効率のボトルネックが存在しました。

### v2.0：モジュールフェデレーションの試み

v2.0 バージョンでは、[Webpack 5.0](https://webpack.js.org/) の[モジュールフェデレーション（Module Federation）](https://webpack.js.org/concepts/module-federation/)技術を採用しました。この技術は、統一されたモジュールローディングメカニズムとランタイムコンテナにより、サービス間の協調効率を大幅に向上させました。しかし、大規模な実践において、モジュールフェデレーションの閉鎖的な実装メカニズムが新たな課題をもたらしました：正確な依存関係バージョン管理が困難で、特に複数のサービスの共有依存関係を統一する際に、バージョン衝突やランタイム例外が頻繁に発生しました。

## ESM 新時代の到来

v3.0 バージョンの計画において、私たちはフロントエンドエコシステムの発展トレンドを深く観察し、ブラウザのネイティブ能力の進化がマイクロフロントエンドアーキテクチャに新たな可能性をもたらしていることを発見しました：

### 標準化されたモジュールシステム

主要なブラウザが [ES Modules](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Guide/Modules) を全面的にサポートし、[Import Maps](https://github.com/WICG/import-maps) 仕様が成熟するにつれ、フロントエンド開発は真のモジュール化時代を迎えました。[Can I Use](https://caniuse.com/?search=importmap) の統計データによると、現在の主要ブラウザ（Chrome >= 89、Edge >= 89、Firefox >= 108、Safari >= 16.4）の ESM ネイティブサポート率は 93.5% に達しており、これにより以下の利点が得られます：

- **依存関係管理の標準化**：Import Maps は、ブラウザレベルでモジュール依存関係を解決する能力を提供し、複雑なランタイム注入を不要にします
- **リソースローディングの最適化**：ブラウザのネイティブなモジュールキャッシュメカニズムにより、リソースローディング効率が大幅に向上します
- **ビルドプロセスの簡素化**：ESM ベースの開発モードにより、開発環境と本番環境のビルドプロセスがより一貫性を持ちます

同時に、互換モードのサポート（Chrome >= 87、Edge >= 88、Firefox >= 78、Safari >= 14）により、ブラウザカバレッジを 96.81% までさらに向上させることができ、高性能を維持しながらも旧バージョンのブラウザサポートを犠牲にしません。

### パフォーマンスと隔離のブレークスルー

ネイティブモジュールシステムがもたらすのは標準化だけでなく、パフォーマンスと隔離性の質的向上です：

- **ゼロランタイムオーバーヘッド**：従来のマイクロフロントエンドソリューションにおける JavaScript サンドボックスプロキシやランタイム注入を排除
- **信頼性の高い隔離メカニズム**：ESM の厳格なモジュールスコープが、最も信頼性の高い隔離能力を提供
- **正確な依存関係管理**：静的インポート分析により、依存関係がより明確になり、バージョンコントロールがより正確になります

### ビルドツールの選択

技術ソリューションの実装において、ビルドツールの選択は重要な意思決定ポイントです。約1年間の技術調査と実践を経て、私たちの選択は以下のように進化しました：

1. **Vite の探求**
   - 利点：ESM ベースの開発サーバーにより、極めて優れた開発体験を提供
   - 課題：開発環境と本番環境のビルド差異により、一定の不確実性が生じます

2. **[Rspack](https://www.rspack.dev/) の確立**
   - パフォーマンスの利点：[Rust](https://www.rust-lang.org/) ベースの高性能コンパイルにより、ビルド速度が大幅に向上
   - エコシステムサポート：Webpack エコシステムとの高い互換性により、移行コストが低減
   - ESM サポート：Rslib プロジェクトの実践を通じて、ESM ビルドの信頼性が検証されました

この意思決定により、開発体験を維持しながら、より安定した本番環境サポートを獲得しました。ESM と Rspack の組み合わせにより、最終的に高性能で低侵入性のマイクロフロントエンドソリューションを構築しました。

## 将来の展望

今後の開発計画において、Gez フレームワークは以下の3つの方向性に重点を置きます：

### Import Maps の深度最適化

- **動的依存関係管理**：ランタイムでの依存関係バージョンのインテリジェントなスケジューリングを実現し、複数アプリケーション間の依存関係衝突を解決
- **プリロード戦略**：ルーティング分析に基づくインテリジェントなプリロードにより、リソースローディング効率を向上
- **ビルド最適化**：最適な Import Maps 設定を自動生成し、開発者の手動設定コストを削減

### フレームワークに依存しないルーティングソリューション

- **統一ルーティング抽象化**：フレームワークに依存しないルーティングインターフェースを設計し、Vue、React などの主要フレームワークをサポート
- **マイクロアプリケーションルーティング**：アプリケーション間のルーティング連動を実現し、URL とアプリケーション状態の一貫性を維持
- **ルーティングミドルウェア**：拡張可能なミドルウェアメカニズムを提供し、権限制御、ページ遷移などの機能をサポート

### クロスフレームワーク通信のベストプラクティス

- **サンプルアプリケーション**：Vue、React、Preact などの主要フレームワークをカバーする完全なクロスフレームワーク通信サンプルを提供
- **状態同期**：ESM ベースの軽量な状態共有ソリューションを実装
- **イベントバス**：標準化されたイベント通信メカニズムにより、アプリケーション間の疎結合通信をサポート

これらの最適化と拡張を通じて、Gez がより完成度が高く、使いやすいマイクロフロントエンドソリューションとなり、開発者により優れた開発体験と高い開発効率を提供することを期待しています。