---
titleSuffix: "マイクロフロントエンドの課題からESM革新へ：Gezフレームワークの進化の道"
description: Gezフレームワークが従来のマイクロフロントエンドアーキテクチャの課題からESMベースの革新へと進化した過程を深く探り、パフォーマンス最適化、依存関係管理、ビルドツール選定などの技術的実践経験を共有します。
head:
  - - meta
    - property: keywords
      content: Gez, マイクロフロントエンドフレームワーク, ESM, Import Maps, Rspack, モジュールフェデレーション, 依存関係管理, パフォーマンス最適化, 技術進化, サーバーサイドレンダリング
sidebar: false
---

# コンポーネント共有からネイティブモジュール化へ：Gezマイクロフロントエンドフレームワークの進化の道

## プロジェクト背景

過去数年間、マイクロフロントエンドアーキテクチャは正しい道を模索してきました。しかし、私たちが目にしてきたのは、理想的なマイクロフロントエンドの世界を模倣するための複雑な技術的解決策でした。これらの解決策は、重いパフォーマンス負荷をもたらし、シンプルな開発を複雑にし、標準的なプロセスを難解にしました。

### 従来の解決策の限界

マイクロフロントエンドアーキテクチャの実践において、従来の解決策の多くの制限を痛感しました：

- **パフォーマンスの低下**：ランタイムでの依存関係注入、JSサンドボックスのプロキシ、すべての操作が貴重なパフォーマンスを消耗します
- **脆弱な隔離**：手動で作成されたサンドボックス環境は、ブラウザのネイティブな隔離能力には到底及びません
- **ビルドの複雑さ**：依存関係を処理するために、ビルドツールを魔改造しなければならず、シンプルなプロジェクトが保守困難になります
- **カスタマイズされたルール**：特殊なデプロイ戦略、ランタイム処理により、すべてのステップが現代の開発標準プロセスから逸脱します
- **エコシステムの制限**：フレームワークの結合、カスタムAPIにより、技術選定が特定のエコシステムに縛られます

これらの問題は、2019年のある企業向けプロジェクトで特に顕著でした。当時、大規模な製品が十数個の独立した業務サブシステムに分割され、これらのサブシステムは共通の基本コンポーネントと業務コンポーネントを共有する必要がありました。最初に採用されたnpmパッケージベースのコンポーネント共有ソリューションは、共有コンポーネントが更新された際に、そのコンポーネントに依存するすべてのサブシステムが完全なビルドとデプロイプロセスを経なければならないという深刻な保守効率の問題を露呈しました。

## 技術的進化

### v1.0：リモートコンポーネントの探求

コンポーネント共有の効率問題を解決するため、Gez v1.0ではHTTPプロトコルに基づくRemoteViewコンポーネントメカニズムを導入しました。このソリューションは、ランタイムでの動的リクエストにより、サービス間のコードをオンデマンドで組み立てることで、ビルド依存チェーンの長さの問題を解決しました。しかし、標準化されたランタイム通信メカニズムが欠如していたため、サービス間の状態同期とイベント伝達には依然として効率のボトルネックが存在しました。

### v2.0：モジュールフェデレーションの試み

v2.0バージョンでは、[Webpack 5.0](https://webpack.js.org/)の[モジュールフェデレーション（Module Federation）](https://webpack.js.org/concepts/module-federation/)技術を採用しました。この技術は、統一されたモジュールロードメカニズムとランタイムコンテナにより、サービス間の協調効率を大幅に向上させました。しかし、大規模な実践において、モジュールフェデレーションの閉鎖的な実装メカニズムは新たな課題をもたらしました：正確な依存関係バージョン管理が難しく、特に複数のサービスの共有依存関係を統一する際に、バージョン衝突やランタイム例外が頻繁に発生しました。

## ESM新時代の到来

v3.0バージョンの計画において、私たちはフロントエンドエコシステムの発展トレンドを深く観察し、ブラウザのネイティブ能力の進化がマイクロフロントエンドアーキテクチャに新たな可能性をもたらしていることを発見しました：

### 標準化されたモジュールシステム

主要なブラウザが[ES Modules](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Guide/Modules)を全面的にサポートし、[Import Maps](https://github.com/WICG/import-maps)仕様が成熟するにつれ、フロントエンド開発は真のモジュール化時代を迎えました。[Can I Use](https://caniuse.com/?search=importmap)の統計データによると、現在の主要ブラウザ（Chrome >= 89、Edge >= 89、Firefox >= 108、Safari >= 16.4）のESMネイティブサポート率は93.5%に達しており、これにより以下の利点が得られます：

- **依存関係管理の標準化**：Import Mapsは、ブラウザレベルでモジュール依存関係を解決する能力を提供し、複雑なランタイム注入を必要としません
- **リソースロードの最適化**：ブラウザのネイティブなモジュールキャッシュメカニズムにより、リソースロード効率が大幅に向上します
- **ビルドプロセスの簡素化**：ESMベースの開発モードにより、開発環境と本番環境のビルドプロセスがより一貫性を持ちます

同時に、互換モードのサポート（Chrome >= 87、Edge >= 88、Firefox >= 78、Safari >= 14）により、ブラウザカバレッジを96.81%までさらに向上させることができ、高性能を維持しながらも旧版ブラウザのサポートを犠牲にしません。

### パフォーマンスと隔離のブレークスルー

ネイティブモジュールシステムがもたらすのは標準化だけでなく、パフォーマンスと隔離性の質的向上です：

- **ゼロランタイムオーバーヘッド**：従来のマイクロフロントエンドソリューションにおけるJavaScriptサンドボックスプロキシとランタイム注入に別れを告げます
- **信頼性の高い隔離メカニズム**：ESMの厳格なモジュールスコープは、最も信頼性の高い隔離能力を自然に提供します
- **正確な依存関係管理**：静的インポート分析により、依存関係がより明確になり、バージョンコントロールがより正確になります

### ビルドツールの選択

技術ソリューションの実装において、ビルドツールの選択は重要な決定ポイントです。約1年間の技術調査と実践を経て、私たちの選択は以下のように進化しました：

1. **Viteの探求**
   - 利点：ESMベースの開発サーバーにより、極めて優れた開発体験を提供します
   - 課題：開発環境と本番環境のビルドの差異により、一定の不確実性が生じます

2. **[Rspack](https://www.rspack.dev/)の確立**
   - パフォーマンスの利点：[Rust](https://www.rust-lang.org/)ベースの高性能コンパイルにより、ビルド速度が大幅に向上します
   - エコシステムのサポート：Webpackエコシステムとの高い互換性により、移行コストが低減されます
   - ESMサポート：Rslibプロジェクトの実践を通じて、ESMビルドにおける信頼性が検証されました

この決定により、開発体験を維持しながら、より安定した本番環境サポートを得ることができました。ESMとRspackの組み合わせに基づき、最終的に高性能で低侵入性のマイクロフロントエンドソリューションを構築しました。

## 将来の展望

今後の発展計画において、Gezフレームワークは以下の3つの方向に重点を置きます：

### Import Mapsの深度最適化

- **動的依存関係管理**：ランタイムでの依存関係バージョンのインテリジェントなスケジューリングを実現し、複数アプリケーション間の依存関係衝突を解決します
- **プリロード戦略**：ルート分析に基づくインテリジェントなプリロードにより、リソースロード効率を向上させます
- **ビルド最適化**：最適なImport Maps設定を自動生成し、開発者の手動設定コストを削減します

### フレームワークに依存しないルーティングソリューション

- **統一ルーティング抽象化**：フレームワークに依存しないルーティングインターフェースを設計し、Vue、Reactなどの主要フレームワークをサポートします
- **マイクロアプリケーションルーティング**：アプリケーション間のルーティング連動を実現し、URLとアプリケーション状態の一貫性を維持します
- **ルーティングミドルウェア**：拡張可能なミドルウェアメカニズムを提供し、権限制御、ページ遷移などの機能をサポートします

### クロスフレームワーク通信のベストプラクティス

- **サンプルアプリケーション**：Vue、React、Preactなどの主要フレームワークをカバーする完全なクロスフレームワーク通信サンプルを提供します
- **状態同期**：ESMベースの軽量な状態共有ソリューションを実装します
- **イベントバス**：標準化されたイベント通信メカニズムにより、アプリケーション間の疎結合通信をサポートします

これらの最適化と拡張を通じて、Gezがより完成度が高く、使いやすいマイクロフロントエンドソリューションとなり、開発者により優れた開発体験と高い開発効率を提供することを期待しています。