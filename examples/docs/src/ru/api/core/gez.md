---
titleSuffix: Справочник API основных классов фреймворка
description: Подробное описание API основных классов фреймворка Gez, включая управление жизненным циклом приложения, обработку статических ресурсов и возможности серверного рендеринга, чтобы помочь разработчикам глубже понять ключевые функции фреймворка.
head:
  - - meta
    - property: keywords
      content: Gez, API, управление жизненным циклом, статические ресурсы, серверный рендеринг, Rspack, фреймворк для веб-приложений
---

# Gez

## Введение

Gez — это высокопроизводительный фреймворк для веб-приложений, основанный на Rspack, который предоставляет полный набор функций для управления жизненным циклом приложения, обработки статических ресурсов и серверного рендеринга.

## Определения типов

### RuntimeTarget

- **Определение типа**:
```ts
type RuntimeTarget = 'client' | 'server'
```

Тип среды выполнения приложения:
- `client`: Работает в браузерной среде, поддерживает операции с DOM и API браузера.
- `server`: Работает в среде Node.js, поддерживает файловую систему и серверные функции.

### ImportMap

- **Определение типа**:
```ts
type ImportMap = {
  imports?: SpecifierMap
  scopes?: ScopesMap
}
```

Тип карты импорта ES-модулей.

#### SpecifierMap

- **Определение типа**:
```ts
type SpecifierMap = Record<string, string>
```

Тип карты идентификаторов модулей, используемый для определения соответствий путей импорта модулей.

#### ScopesMap

- **Определение типа**:
```ts
type ScopesMap = Record<string, SpecifierMap>
```

Тип карты областей видимости, используемый для определения соответствий путей импорта модулей в определенных областях видимости.

### COMMAND

- **Определение типа**:
```ts
enum COMMAND {
    dev = 'dev',
    build = 'build',
    preview = 'preview',
    start = 'start'
}
```

Перечисление типов команд:
- `dev`: Команда для среды разработки, запускает сервер разработки с поддержкой горячей перезагрузки.
- `build`: Команда сборки, генерирует артефакты для production-среды.
- `preview`: Команда предпросмотра, запускает локальный сервер предпросмотра.
- `start`: Команда запуска, запускает сервер для production-среды.

## Опции экземпляра

Определение основных параметров конфигурации фреймворка Gez.

```ts
interface GezOptions {
  root?: string
  isProd?: boolean
  basePathPlaceholder?: string | false
  modules?: ModuleConfig
  packs?: PackConfig
  devApp?: (gez: Gez) => Promise<App>
  server?: (gez: Gez) => Promise<void>
  postBuild?: (gez: Gez) => Promise<void>
}
```

#### root

- **Тип**: `string`
- **Значение по умолчанию**: `process.cwd()`

Путь к корневой директории проекта. Может быть абсолютным или относительным путем, относительные пути разрешаются относительно текущей рабочей директории.

#### isProd

- **Тип**: `boolean`
- **Значение по умолчанию**: `process.env.NODE_ENV === 'production'`

Идентификатор среды.
- `true`: Production-среда.
- `false`: Среда разработки.

#### basePathPlaceholder

- **Тип**: `string | false`
- **Значение по умолчанию**: `'[[[___GEZ_DYNAMIC_BASE___]]]'`

Конфигурация заполнителя базового пути. Используется для динамической замены базового пути ресурсов во время выполнения. Установка значения `false` отключает эту функцию.

#### modules

- **Тип**: `ModuleConfig`

Опции конфигурации модулей. Используются для настройки правил разрешения модулей проекта, включая алиасы модулей и внешние зависимости.

#### packs

- **Тип**: `PackConfig`

Опции конфигурации сборки. Используются для упаковки артефактов сборки в стандартные npm-пакеты формата .tgz.

#### devApp

- **Тип**: `(gez: Gez) => Promise<App>`

Функция создания приложения для среды разработки. Используется только в среде разработки для создания экземпляра приложения сервера разработки.

```ts title="entry.node.ts"
export default {
  async devApp(gez) {
    return import('@gez/rspack').then((m) =>
      m.createRspackHtmlApp(gez, {
        config(context) {
          // Пользовательская конфигурация Rspack
        }
      })
    )
  }
}
```

#### server

- **Тип**: `(gez: Gez) => Promise<void>`

Функция конфигурации запуска сервера. Используется для настройки и запуска HTTP-сервера, может использоваться как в среде разработки, так и в production-среде.

```ts title="entry.node.ts"
export default {
  async server(gez) {
    const server = http.createServer((req, res) => {
      gez.middleware(req, res, async () => {
        const render = await gez.render({
          params: { url: req.url }
        });
        res.end(render.html);
      });
    });

    server.listen(3000);
  }
}
```

#### postBuild

- **Тип**: `(gez: Gez) => Promise<void>`

Функция постобработки после сборки. Выполняется после завершения сборки проекта, может использоваться для:
- Дополнительной обработки ресурсов.
- Операций развертывания.
- Генерации статических файлов.
- Отправки уведомлений о сборке.

## Свойства экземпляра

### name

- **Тип**: `string`
- **Только для чтения**: `true`

Имя текущего модуля, взятое из конфигурации модуля.

### varName

- **Тип**: `string`
- **Только для чтения**: `true`

Допустимое имя переменной JavaScript, сгенерированное на основе имени модуля.

### root

- **Тип**: `string`
- **Только для чтения**: `true`

Абсолютный путь к корневой директории проекта. Если в конфигурации указан относительный путь `root`, он будет разрешен относительно текущей рабочей директории.

### isProd

- **Тип**: `boolean`
- **Только для чтения**: `true`

Определяет, находится ли текущая среда в production-режиме. Приоритет отдается параметру конфигурации `isProd`, если он не задан, то используется значение `process.env.NODE_ENV`.

### basePath

- **Тип**: `string`
- **Только для чтения**: `true`
- **Исключение**: `NotReadyError` - если фреймворк не инициализирован

Получает базовый путь модуля, начинающийся и заканчивающийся косой чертой. Возвращает путь в формате `/${name}/`, где name берется из конфигурации модуля.

### basePathPlaceholder

- **Тип**: `string`
- **Только для чтения**: `true`

Получает заполнитель базового пути для динамической замены во время выполнения. Может быть отключен через конфигурацию.

### middleware

- **Тип**: `Middleware`
- **Только для чтения**: `true`

Получает middleware для обработки статических ресурсов. В зависимости от среды предоставляет разные реализации:
- Среда разработки: поддерживает компиляцию исходного кода в реальном времени и горячую перезагрузку.
- Production-среда: поддерживает долгосрочное кэширование статических ресурсов.

```ts
const server = http.createServer((req, res) => {
  gez.middleware(req, res, async () => {
    const rc = await gez.render({ url: req.url });
    res.end(rc.html);
  });
});
```

### render

- **Тип**: `(options?: RenderContextOptions) => Promise<RenderContext>`
- **Только для чтения**: `true`

Получает функцию серверного рендеринга. В зависимости от среды предоставляет разные реализации:
- Среда разработки: поддерживает горячую перезагрузку и предпросмотр в реальном времени.
- Production-среда: обеспечивает оптимизированную производительность рендеринга.

```ts
// Базовое использование
const rc = await gez.render({
  params: { url: req.url }
});

// Расширенная конфигурация
const rc = await gez.render({
  base: '',                    // Базовый путь
  importmapMode: 'inline',     // Режим карты импорта
  entryName: 'default',        // Точка входа для рендеринга
  params: {
    url: req.url,
    state: { user: 'admin' }   // Данные состояния
  }
});
```

### COMMAND

- **Тип**: `typeof COMMAND`
- **Только для чтения**: `true`

Получает определение перечисления типов команд.

### moduleConfig

- **Тип**: `ParsedModuleConfig`
- **Только для чтения**: `true`
- **Исключение**: `NotReadyError` - если фреймворк не инициализирован

Получает полную конфигурацию текущего модуля, включая правила разрешения модулей, алиасы и другие параметры.

### packConfig

- **Тип**: `ParsedPackConfig`
- **Только для чтения**: `true`
- **Исключение**: `NotReadyError` - если фреймворк не инициализирован

Получает конфигурацию сборки текущего модуля, включая пути вывода, обработку package.json и другие параметры.

## Методы экземпляра

### constructor()

- **Параметры**: 
  - `options?: GezOptions` - параметры конфигурации фреймворка
- **Возвращаемое значение**: `Gez`

Создает экземпляр фреймворка Gez.

```ts
const gez = new Gez({
  root: './src',
  isProd: process.env.NODE_ENV === 'production'
});
```

### init()

- **Параметры**: `command: COMMAND`
- **Возвращаемое значение**: `Promise<boolean>`
- **Исключения**:
  - `Error`: при повторной инициализации
  - `NotReadyError`: при доступе к неинициализированному экземпляру

Инициализирует экземпляр фреймворка Gez. Выполняет следующие основные шаги инициализации:

1. Разрешает конфигурацию проекта (package.json, конфигурация модулей, конфигурация сборки и т.д.)
2. Создает экземпляр приложения (для среды разработки или production-среды)
3. Выполняет соответствующие методы жизненного цикла в зависимости от команды

::: warning Внимание
- Повторная инициализация вызовет ошибку
- Доступ к неинициализированному экземпляру вызовет `NotReadyError`

:::

```ts
const gez = new Gez({
  root: './src',
  isProd: process.env.NODE_ENV === 'production'
});

await gez.init(COMMAND.dev);
```

### destroy()

- **Возвращаемое значение**: `Promise<boolean>`

Уничтожает экземпляр фреймворка Gez, выполняя очистку ресурсов и закрытие соединений. Основные применения:
- Закрытие сервера разработки
- Очистка временных файлов и кэша
- Освобождение системных ресурсов

```ts
process.once('SIGTERM', async () => {
  await gez.destroy();
  process.exit(0);
});
```

### build()

- **Возвращаемое значение**: `Promise<boolean>`

Выполняет процесс сборки приложения, включая:
- Компиляцию исходного кода
- Генерацию артефактов для production-среды
- Оптимизацию и минификацию кода
- Генерацию манифеста ресурсов

::: warning Внимание
Вызов до инициализации экземпляра фреймворка вызовет `NotReadyError`
:::

```ts title="entry.node.ts"
export default {
  async postBuild(gez) {
    await gez.build();
    // Генерация статического HTML после сборки
    const render = await gez.render({
      params: { url: '/' }
    });
    gez.writeSync(
      gez.resolvePath('dist/client', 'index.html'),
      render.html
    );
  }
}
```

### server()

- **Возвращаемое значение**: `Promise<void>`
- **Исключение**: `NotReadyError` - если фреймворк не инициализирован

Запускает HTTP-сервер и настраивает экземпляр сервера. Вызывается на следующих этапах жизненного цикла:
- Среда разработки (dev): запускает сервер разработки с поддержкой горячей перезагрузки
- Production-среда (start): запускает сервер для production-среды с оптимизированной производительностью

```ts title="entry.node.ts"
export default {
  async server(gez) {
    const server = http.createServer((req, res) => {
      // Обработка статических ресурсов
      gez.middleware(req, res, async () => {
        // Серверный рендеринг
        const render = await gez.render({
          params: { url: req.url }
        });
        res.end(render.html);
      });
    });

    server.listen(3000, () => {
      console.log('Server running at http://localhost:3000');
    });
  }
}
```

### postBuild()

- **Возвращаемое значение**: `Promise<boolean>`

Выполняет логику постобработки после сборки, используется для:
- Генерации статических HTML-файлов
- Обработки артефактов сборки
- Выполнения задач развертывания
- Отправки уведомлений о сборке

```ts title="entry.node.ts"
export default {
  async postBuild(gez) {
    // Генерация статических HTML для нескольких страниц
    const pages = ['/', '/about', '/404'];

    for (const url of pages) {
      const render = await gez.render({
        params: { url }
      });

      await gez.write(
        gez.resolvePath('dist/client', url.substring(1), 'index.html'),
        render.html
      );
    }
  }
}
```

### resolvePath

Разрешает путь проекта, преобразуя относительный путь в абсолютный.

- **Параметры**:
  - `projectPath: ProjectPath` - тип пути проекта
  - `...args: string[]` - фрагменты пути
- **Возвращаемое значение**: `string` - абсолютный путь

- **Пример**:
```ts
// Разрешение пути к статическому ресурсу
const htmlPath = gez.resolvePath('dist/client', 'index.html');
```

### writeSync()

Синхронная запись содержимого в файл.

- **Параметры**:
  - `filepath`: `string` - абсолютный путь к файлу
  - `data`: `any` - данные для записи, могут быть строкой, Buffer или объектом
- **Возвращаемое значение**: `boolean` - успешность записи

- **Пример**:
```ts title="src/entry.node.ts"

async postBuild(gez) {
  const htmlPath = gez.resolvePath('dist/client', 'index.html');
  const success = await gez.write(htmlPath, '<html>...</html>');
}
```

### readJsonSync()

Синхронное чтение и парсинг JSON-файла.

- **Параметры**:
  - `filename`: `string` - абсолютный путь к JSON-файлу

- **Возвращаемое значение**: `any` - распарсенный JSON-объект
- **Исключение**: выбрасывается, если файл не существует или JSON имеет неверный формат

- **Пример**:
```ts title="src/entry.node.ts"
async server(gez) {
  const manifest = gez.readJsonSync(gez.resolvePath('dist/client', 'manifest.json'));
  // Использование объекта manifest
}
```

### readJson()

Асинхронное чтение и парсинг JSON-файла.

- **Параметры**:
  - `filename`: `string` - абсолютный путь к JSON-файлу

- **Возвращаемое значение**: `Promise<any>` - распарсенный JSON-объект
- **Исключение**: выбрасывается, если файл не существует или JSON имеет неверный формат

- **Пример**:
```ts title="src/entry.node.ts"
async server(gez) {
  const manifest = await gez.readJson(gez.resolvePath('dist/client', 'manifest.json'));
  // Использование объекта manifest
}
```

### getManifestList()

Получает список манифестов сборки.

- **Параметры**:
  - `target