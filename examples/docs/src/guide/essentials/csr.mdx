# 客户端渲染

客户端渲染（Client-Side Rendering，CSR）是一种在浏览器端执行页面渲染技术方案。在 Gez 中，当你的应用无法部署 Node.js 服务器实例时，可以选择在构建阶段生成静态的 `index.html` 文件，实现纯客户端渲染。

## 使用场景

以下场景推荐使用客户端渲染：

- 静态托管环境：如 GitHub Pages、CDN 等不支持服务端渲染的托管服务
- 简单应用：对首屏加载速度和 SEO 要求不高的小型应用
- 开发环境：在开发阶段快速预览和调试应用

## 客户端模板配置

在客户端渲染模式下，你需要配置一个通用的 HTML 模板。这个模板将作为应用的容器，包含必要的资源引用和挂载点。

```ts title="src/entry.server.ts"
import type { RenderContext } from '@gez/core';

export default async (rc: RenderContext) => {
    // 提交依赖收集
    await rc.commit();
    
    // 配置 HTML 模板
    rc.html = `
<!DOCTYPE html>
<html>
<head>
    ${rc.preload()}     // 预加载资源
    <title>Gez</title>
    ${rc.css()}         // 注入样式
</head>
<body>
    <div id="app"></div>
    ${rc.importmap()}    // 导入映射
    ${rc.moduleEntry()}  // 入口模块
    ${rc.modulePreload()} // 模块预加载
</body>
</html>
`;
};
```

## 生成静态 HTML

要在生产环境中使用客户端渲染，需要在构建阶段生成静态的 HTML 文件。Gez 提供了 `postBuild` 钩子函数来实现这一功能。

```ts title="src/entry.node.ts"
import path from 'node:path';
import type { GezOptions } from '@gez/core';

export default {
    // ... 其它配置项
    async postBuild(gez) {
        // 执行一次渲染，获取渲染上下文
        const { rc } = await gez.render({
            params: {
                url: '/'  // 指定要渲染的页面路径
            }
        });

        // 将生成的 HTML 写入文件
        // 注意：这里使用 params.url 作为路径
        gez.writeSync(
            gez.resolvePath('dist/client', 'index.html'),
            rc.html
        );
    }
} satisfies GezOptions;
```

::: tip 提示
`postBuild` 钩子会在生产环境构建完成后执行。你可以利用这个钩子不仅生成客户端渲染所需的 HTML 文件，还可以实现完整的静态站点生成（SSG）功能。
:::

## 部署说明

完成构建后，将 `dist/client/` 目录下的所有文件部署到你的静态文件服务器或 CDN 即可。确保：

1. 所有静态资源（JS、CSS、图片等）都能被正确访问
2. 服务器配置了适当的 MIME 类型
3. 对于单页应用（SPA），配置适当的路由回退机制
