"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([["4887"],{7687:function(n,e,t){t.r(e),t.d(e,{default:()=>h});var r=t(1549),c=t(6603);function s(n){let e=Object.assign({h1:"h1",a:"a",p:"p",h2:"h2",pre:"pre",code:"code",h3:"h3",ol:"ol",li:"li"},(0,c.ah)(),n.components);return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(e.h1,{id:"preacthtm",children:["Preact+HTM",(0,r.jsx)(e.a,{className:"header-anchor","aria-hidden":"true",href:"#preacthtm",children:"#"})]}),"\n",(0,r.jsx)(e.p,{children:"Hướng dẫn n\xe0y sẽ gi\xfap bạn x\xe2y dựng một ứng dụng Preact+HTM SSR từ đầu với Gez. Ch\xfang ta sẽ sử dụng một v\xed dụ ho\xe0n chỉnh để minh họa c\xe1ch tạo ứng dụng render ph\xeda server với Gez framework."}),"\n",(0,r.jsxs)(e.h2,{id:"cấu-tr\\xfac-dự-\\xe1n",children:["Cấu tr\xfac dự \xe1n",(0,r.jsx)(e.a,{className:"header-anchor","aria-hidden":"true",href:"#cấu-tr\\xfac-dự-\\xe1n",children:"#"})]}),"\n",(0,r.jsx)(e.p,{children:"Đầu ti\xean, h\xe3y t\xecm hiểu cấu tr\xfac cơ bản của dự \xe1n:"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-bash",children:".\n├── package.json         # File cấu h\xecnh dự \xe1n, định nghĩa c\xe1c dependency v\xe0 script\n├── tsconfig.json        # File cấu h\xecnh TypeScript, thiết lập c\xe1c t\xf9y chọn bi\xean dịch\n└── src                  # Thư mục m\xe3 nguồn\n    ├── app.ts           # Component ch\xednh của ứng dụng, định nghĩa cấu tr\xfac trang v\xe0 logic tương t\xe1c\n    ├── create-app.ts    # Factory tạo instance ứng dụng, chịu tr\xe1ch nhiệm khởi tạo ứng dụng\n    ├── entry.client.ts  # File entry ph\xeda client, xử l\xfd render ph\xeda tr\xecnh duyệt\n    ├── entry.node.ts    # File entry Node.js server, chịu tr\xe1ch nhiệm cấu h\xecnh m\xf4i trường ph\xe1t triển v\xe0 khởi động server\n    └── entry.server.ts  # File entry ph\xeda server, xử l\xfd logic render SSR\n"})}),"\n",(0,r.jsxs)(e.h2,{id:"cấu-h\\xecnh-dự-\\xe1n",children:["Cấu h\xecnh dự \xe1n",(0,r.jsx)(e.a,{className:"header-anchor","aria-hidden":"true",href:"#cấu-h\\xecnh-dự-\\xe1n",children:"#"})]}),"\n",(0,r.jsxs)(e.h3,{id:"packagejson",children:["package.json",(0,r.jsx)(e.a,{className:"header-anchor","aria-hidden":"true",href:"#packagejson",children:"#"})]}),"\n",(0,r.jsxs)(e.p,{children:["Tạo file ",(0,r.jsx)(e.code,{children:"package.json"}),", cấu h\xecnh c\xe1c dependency v\xe0 script của dự \xe1n:"]}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-json",meta:'title="package.json"',children:'{\n  "name": "ssr-demo-preact-htm",\n  "version": "1.0.0",\n  "type": "module",\n  "private": true,\n  "scripts": {\n    "dev": "gez dev",\n    "build": "npm run build:dts && npm run build:ssr",\n    "build:ssr": "gez build",\n    "preview": "gez preview",\n    "start": "NODE_ENV=production node dist/index.js",\n    "build:dts": "tsc --declaration --emitDeclarationOnly --outDir dist/src"\n  },\n  "dependencies": {\n    "@gez/core": "*"\n  },\n  "devDependencies": {\n    "@gez/rspack": "*",\n    "@types/node": "22.8.6",\n    "htm": "^3.1.1",\n    "preact": "^10.26.2",\n    "preact-render-to-string": "^6.5.13",\n    "typescript": "^5.2.2"\n  }\n}\n'})}),"\n",(0,r.jsxs)(e.p,{children:["Sau khi tạo file ",(0,r.jsx)(e.code,{children:"package.json"}),", bạn cần c\xe0i đặt c\xe1c dependency của dự \xe1n. Bạn c\xf3 thể sử dụng một trong c\xe1c lệnh sau để c\xe0i đặt:"]}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-bash",children:"pnpm install\n# hoặc\nyarn install\n# hoặc\nnpm install\n"})}),"\n",(0,r.jsx)(e.p,{children:"Lệnh n\xe0y sẽ c\xe0i đặt tất cả c\xe1c g\xf3i dependency cần thiết, bao gồm Preact, HTM, TypeScript v\xe0 c\xe1c dependency li\xean quan đến SSR."}),"\n",(0,r.jsxs)(e.h3,{id:"tsconfigjson",children:["tsconfig.json",(0,r.jsx)(e.a,{className:"header-anchor","aria-hidden":"true",href:"#tsconfigjson",children:"#"})]}),"\n",(0,r.jsxs)(e.p,{children:["Tạo file ",(0,r.jsx)(e.code,{children:"tsconfig.json"}),", cấu h\xecnh c\xe1c t\xf9y chọn bi\xean dịch TypeScript:"]}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-json",meta:'title="tsconfig.json"',children:'{\n    "compilerOptions": {\n        "isolatedModules": true,\n        "experimentalDecorators": true,\n        "resolveJsonModule": true,\n        "types": [\n            "@types/node"\n        ],\n        "target": "ESNext",\n        "module": "ESNext",\n        "moduleResolution": "node",\n        "strict": true,\n        "skipLibCheck": true,\n        "allowSyntheticDefaultImports": true,\n        "paths": {\n            "ssr-demo-preact-htm/src/*": [\n                "./src/*"\n            ],\n            "ssr-demo-preact-htm/*": [\n                "./*"\n            ]\n        }\n    },\n    "include": [\n        "src"\n    ],\n    "exclude": [\n        "dist"\n    ]\n}\n'})}),"\n",(0,r.jsxs)(e.h2,{id:"cấu-tr\\xfac-m\\xe3-nguồn",children:["Cấu tr\xfac m\xe3 nguồn",(0,r.jsx)(e.a,{className:"header-anchor","aria-hidden":"true",href:"#cấu-tr\\xfac-m\\xe3-nguồn",children:"#"})]}),"\n",(0,r.jsxs)(e.h3,{id:"appts",children:["app.ts",(0,r.jsx)(e.a,{className:"header-anchor","aria-hidden":"true",href:"#appts",children:"#"})]}),"\n",(0,r.jsxs)(e.p,{children:["Tạo component ch\xednh ",(0,r.jsx)(e.code,{children:"src/app.ts"}),", sử dụng class component của Preact v\xe0 HTM:"]}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-ts",meta:'title="src/app.ts"',children:"/**\n * @file V\xed dụ component\n * @description Hiển thị ti\xeau đề trang với thời gian tự động cập nhật, d\xf9ng để minh họa c\xe1c chức năng cơ bản của Gez framework\n */\n\nimport { Component } from 'preact';\nimport { html } from 'htm/preact';\n\nexport default class App extends Component {\n    state = {\n        time: new Date().toISOString()\n    };\n\n    timer: NodeJS.Timeout | null = null;\n\n    componentDidMount() {\n        this.timer = setInterval(() => {\n            this.setState({\n                time: new Date().toISOString()\n            });\n        }, 1000);\n    }\n\n    componentWillUnmount() {\n        if (this.timer) {\n            clearInterval(this.timer);\n        }\n    }\n\n    render() {\n        const { time } = this.state;\n        return html`\n            <div>\n                <h1><a href=\"https://www.jsesm.com/guide/frameworks/preact-htm.html\" target=\"_blank\">Hướng dẫn nhanh Gez</a></h1>\n                <time datetime=${time}>${time}</time>\n            </div>\n        `;\n    }\n}\n"})}),"\n",(0,r.jsxs)(e.h3,{id:"create-appts",children:["create-app.ts",(0,r.jsx)(e.a,{className:"header-anchor","aria-hidden":"true",href:"#create-appts",children:"#"})]}),"\n",(0,r.jsxs)(e.p,{children:["Tạo file ",(0,r.jsx)(e.code,{children:"src/create-app.ts"}),", chịu tr\xe1ch nhiệm tạo instance ứng dụng:"]}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-ts",meta:'title="src/create-app.ts"',children:"/**\n * @file Tạo instance ứng dụng\n * @description Chịu tr\xe1ch nhiệm tạo v\xe0 cấu h\xecnh instance ứng dụng\n */\n\nimport type { VNode } from 'preact';\nimport { html } from 'htm/preact';\nimport App from './app';\n\nexport function createApp(): { app: VNode } {\n    const app = html`<${App} />`;\n    return {\n        app\n    };\n}\n"})}),"\n",(0,r.jsxs)(e.h3,{id:"entryclientts",children:["entry.client.ts",(0,r.jsx)(e.a,{className:"header-anchor","aria-hidden":"true",href:"#entryclientts",children:"#"})]}),"\n",(0,r.jsxs)(e.p,{children:["Tạo file entry ph\xeda client ",(0,r.jsx)(e.code,{children:"src/entry.client.ts"}),":"]}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-ts",meta:'title="src/entry.client.ts"',children:"/**\n * @file File entry ph\xeda client\n * @description Chịu tr\xe1ch nhiệm xử l\xfd logic tương t\xe1c ph\xeda client v\xe0 cập nhật động\n */\n\nimport { render } from 'preact';\nimport { createApp } from './create-app';\n\n// Tạo instance ứng dụng\nconst { app } = createApp();\n\n// Mount instance ứng dụng\nrender(app, document.getElementById('app')!);\n"})}),"\n",(0,r.jsxs)(e.h3,{id:"entrynodets",children:["entry.node.ts",(0,r.jsx)(e.a,{className:"header-anchor","aria-hidden":"true",href:"#entrynodets",children:"#"})]}),"\n",(0,r.jsxs)(e.p,{children:["Tạo file ",(0,r.jsx)(e.code,{children:"entry.node.ts"}),", cấu h\xecnh m\xf4i trường ph\xe1t triển v\xe0 khởi động server:"]}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-ts",meta:'title="src/entry.node.ts"',children:"/**\n * @file File entry Node.js server\n * @description Chịu tr\xe1ch nhiệm cấu h\xecnh m\xf4i trường ph\xe1t triển v\xe0 khởi động server, cung cấp m\xf4i trường runtime SSR\n */\n\nimport http from 'node:http';\nimport type { GezOptions } from '@gez/core';\n\nexport default {\n    /**\n     * Cấu h\xecnh app creator cho m\xf4i trường ph\xe1t triển\n     * @description Tạo v\xe0 cấu h\xecnh instance Rspack app, d\xf9ng cho việc build v\xe0 hot update trong m\xf4i trường ph\xe1t triển\n     * @param gez Instance Gez framework, cung cấp c\xe1c chức năng v\xe0 interface cấu h\xecnh\n     * @returns Trả về instance Rspack app đ\xe3 được cấu h\xecnh, hỗ trợ HMR v\xe0 preview trực tiếp\n     */\n    async devApp(gez) {\n        return import('@gez/rspack').then((m) =>\n            m.createRspackHtmlApp(gez, {\n                config(context) {\n                    // T\xf9y chỉnh cấu h\xecnh bi\xean dịch Rspack tại đ\xe2y\n                }\n            })\n        );\n    },\n\n    /**\n     * Cấu h\xecnh v\xe0 khởi động HTTP server\n     * @description Tạo instance HTTP server, t\xedch hợp Gez middleware, xử l\xfd c\xe1c request SSR\n     * @param gez Instance Gez framework, cung cấp middleware v\xe0 chức năng render\n     */\n    async server(gez) {\n        const server = http.createServer((req, res) => {\n            // Sử dụng Gez middleware để xử l\xfd request\n            gez.middleware(req, res, async () => {\n                // Thực hiện render ph\xeda server\n                const rc = await gez.render({\n                    params: { url: req.url }\n                });\n                res.end(rc.html);\n            });\n        });\n\n        server.listen(3000, () => {\n            console.log('Server đ\xe3 khởi động: http://localhost:3000');\n        });\n    }\n} satisfies GezOptions;\n"})}),"\n",(0,r.jsx)(e.p,{children:"File n\xe0y l\xe0 file entry cấu h\xecnh m\xf4i trường ph\xe1t triển v\xe0 khởi động server, bao gồm hai chức năng ch\xednh:"}),"\n",(0,r.jsxs)(e.ol,{children:["\n",(0,r.jsxs)(e.li,{children:["H\xe0m ",(0,r.jsx)(e.code,{children:"devApp"}),": Chịu tr\xe1ch nhiệm tạo v\xe0 cấu h\xecnh instance Rspack app cho m\xf4i trường ph\xe1t triển, hỗ trợ hot update v\xe0 preview trực tiếp. Ở đ\xe2y sử dụng ",(0,r.jsx)(e.code,{children:"createRspackHtmlApp"})," để tạo instance Rspack app d\xe0nh ri\xeang cho Preact+HTM."]}),"\n",(0,r.jsxs)(e.li,{children:["H\xe0m ",(0,r.jsx)(e.code,{children:"server"}),": Chịu tr\xe1ch nhiệm tạo v\xe0 cấu h\xecnh HTTP server, t\xedch hợp Gez middleware để xử l\xfd c\xe1c request SSR."]}),"\n"]}),"\n",(0,r.jsxs)(e.h3,{id:"entryserverts",children:["entry.server.ts",(0,r.jsx)(e.a,{className:"header-anchor","aria-hidden":"true",href:"#entryserverts",children:"#"})]}),"\n",(0,r.jsxs)(e.p,{children:["Tạo file entry render ph\xeda server ",(0,r.jsx)(e.code,{children:"src/entry.server.ts"}),":"]}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-ts",meta:'title="src/entry.server.ts"',children:"/**\n * @file File entry render ph\xeda server\n * @description Chịu tr\xe1ch nhiệm quy tr\xecnh render ph\xeda server, tạo HTML v\xe0 inject t\xe0i nguy\xean\n */\n\nimport type { RenderContext } from '@gez/core';\nimport type { VNode } from 'preact';\nimport { render } from 'preact-render-to-string';\nimport { createApp } from './create-app';\n\nexport default async (rc: RenderContext) => {\n    // Tạo instance ứng dụng\n    const { app } = createApp();\n\n    // Sử dụng renderToString của Preact để tạo nội dung trang\n    const html = render(app);\n\n    // Commit dependency collection, đảm bảo tất cả c\xe1c t\xe0i nguy\xean cần thiết được tải\n    await rc.commit();\n\n    // Tạo cấu tr\xfac HTML ho\xe0n chỉnh\n    rc.html = `<!DOCTYPE html>\n<html lang=\"vi\">\n<head>\n    ${rc.preload()}\n    <title>Hướng dẫn nhanh Gez</title>\n    ${rc.css()}\n</head>\n<body>\n    <div id=\"app\">${html}</div>\n    ${rc.importmap()}\n    ${rc.moduleEntry()}\n    ${rc.modulePreload()}\n</body>\n</html>\n`;\n};\n"})}),"\n",(0,r.jsxs)(e.h2,{id:"chạy-dự-\\xe1n",children:["Chạy dự \xe1n",(0,r.jsx)(e.a,{className:"header-anchor","aria-hidden":"true",href:"#chạy-dự-\\xe1n",children:"#"})]}),"\n",(0,r.jsx)(e.p,{children:"Sau khi ho\xe0n th\xe0nh c\xe1c cấu h\xecnh file tr\xean, bạn c\xf3 thể sử dụng c\xe1c lệnh sau để chạy dự \xe1n:"}),"\n",(0,r.jsxs)(e.ol,{children:["\n",(0,r.jsx)(e.li,{children:"Chế độ ph\xe1t triển:"}),"\n"]}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-bash",children:"npm run dev\n"})}),"\n",(0,r.jsxs)(e.ol,{start:"2",children:["\n",(0,r.jsx)(e.li,{children:"Build dự \xe1n:"}),"\n"]}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-bash",children:"npm run build\n"})}),"\n",(0,r.jsxs)(e.ol,{start:"3",children:["\n",(0,r.jsx)(e.li,{children:"Chạy m\xf4i trường production:"}),"\n"]}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-bash",children:"npm run start\n"})}),"\n",(0,r.jsxs)(e.p,{children:["B\xe2y giờ, bạn đ\xe3 tạo th\xe0nh c\xf4ng một ứng dụng Preact+HTM SSR với Gez! Truy cập ",(0,r.jsx)(e.a,{href:"http://localhost:3000",target:"_blank",rel:"noopener noreferrer",children:"http://localhost:3000"})," để xem kết quả."]})]})}function i(){let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{wrapper:e}=Object.assign({},(0,c.ah)(),n.components);return e?(0,r.jsx)(e,{...n,children:(0,r.jsx)(s,{...n})}):s(n)}let h=i;i.__RSPRESS_PAGE_META={},i.__RSPRESS_PAGE_META["vi%2Fguide%2Fframeworks%2Fpreact-htm.md"]={toc:[{text:"Cấu tr\xfac dự \xe1n",id:"cấu-tr\xfac-dự-\xe1n",depth:2},{text:"Cấu h\xecnh dự \xe1n",id:"cấu-h\xecnh-dự-\xe1n",depth:2},{text:"package.json",id:"packagejson",depth:3},{text:"tsconfig.json",id:"tsconfigjson",depth:3},{text:"Cấu tr\xfac m\xe3 nguồn",id:"cấu-tr\xfac-m\xe3-nguồn",depth:2},{text:"app.ts",id:"appts",depth:3},{text:"create-app.ts",id:"create-appts",depth:3},{text:"entry.client.ts",id:"entryclientts",depth:3},{text:"entry.node.ts",id:"entrynodets",depth:3},{text:"entry.server.ts",id:"entryserverts",depth:3},{text:"Chạy dự \xe1n",id:"chạy-dự-\xe1n",depth:2}],title:"Preact+HTM",headingTitle:"Preact+HTM",frontmatter:{titleSuffix:"V\xed dụ ứng dụng Preact+HTM SSR với Gez Framework",description:"Hướng dẫn x\xe2y dựng ứng dụng Preact+HTM SSR từ đầu với Gez, qua v\xed dụ minh họa c\xe1ch sử dụng cơ bản của framework, bao gồm khởi tạo dự \xe1n, cấu h\xecnh Preact v\xe0 thiết lập file entry.",head:[["meta",{property:"keywords",content:"Gez, Preact, HTM, Ứng dụng SSR, Cấu h\xecnh TypeScript, Khởi tạo dự \xe1n, Render ph\xeda server, Tương t\xe1c ph\xeda client"}]]}}}}]);